{% extends 'user_management_template.html' %} {% block inner_content %}
<div class="mb-3 h-[50%] grid-cols-3 md:m-5 md:grid md:gap-5 md:p-5">
  <div class="col-span-1 hidden md:block">
    <h1 class="font-extrabold">Users</h1>
    <p>
      The Invite Users feature allows admins to invite new members to join the
      platform securely and with a designated role. Admins can enter the email
      address and assign a role (such as Admin, Shipper, Forwarder, or Customer)
      to each invitee. Upon sending an invitation, the recipient receives an
      email with a unique link to create their account and complete registration
    </p>
    <button class="button mt-3 bg-blue-400" onclick="openInviteModal()">
      Invite Users
    </button>
  </div>
  <div
    class="flex max-h-full min-h-[80%] flex-col gap-3 overflow-y-auto rounded-lg border bg-blue-100 p-5 md:col-span-2"
  >
    {% if users %} {% for user in users %}
    <div class="flex items-center justify-between gap-5 text-sm md:text-base">
      <div class="flex items-center">
        <svg
          class="hidden h-10 w-10 md:block"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6"
        >
          <path
            fill-rule="evenodd"
            d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z"
            cli
            class="side-menu-item"
            p-rule="evenodd"
          />
        </svg>
        <div>
          <h1 class="gap-x-4 font-bold">
            {{user.firstname}} {{user.lastname}}
          </h1>
          <p class="text-gray-600">{{user.email}}</p>
        </div>
      </div>
      <div class="flex gap-5">
        <form class="hidden md:block">
          <select name="role" id="role" class="form-control bg-blue-200">
            <option value="Admin">Admin</option>
            <option value="Admin">Shipper</option>
            <option value="Admin">Forwarder</option>
            <option value="Admin">Customer</option>
          </select>
        </form>
        <a
          href="{{url_for('user-management.delete_user',id=user._id)}}"
          class="button w-auto"
          ><svg
            class="h-4 w-4 md:h-6 md:w-6"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10 12V17"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M14 12V17"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M4 7H20"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M6 10V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V10"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            /></svg
        ></a>
      </div>
    </div>
    {% endfor %} {% else %}
    <h1>No Users</h1>
    {% endif %}
  </div>
  <button
    class="button mt-3 h-10 w-auto bg-blue-400 md:hidden"
    onclick="openInviteModal()"
  >
    Invite Users
  </button>
</div>

<div class="grid h-[40%] grid-cols-3 gap-5 border-t md:m-5 md:p-5">
  <div class="col-span-1 hidden md:block">
    <h1 class="font-extrabold">Pending Invitations</h1>
    <p>
      Here, admins can view outstanding invitations sent to users who have not
      yet completed registration. Each entry includes the recipientâ€™s email,
      role, and the date the invitation was sent. Admins have options to resend
      or cancel invitations, making it easy to track and manage new users
      joining the platform.
    </p>
  </div>
  <div
    class="col-span-3 max-h-full overflow-y-auto rounded-lg border bg-blue-100 p-5 text-sm md:col-span-2 md:text-base"
  >
    {% if invitations %} {% for invitation in invitations %} {% if not
    invitation.is_used %}
    <div class="flex items-center justify-between gap-5">
      <div class="flex items-center">
        <svg
          class="hidden h-10 w-10 md:block"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6"
        >
          <path
            fill-rule="evenodd"
            d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z"
            cli
            class="side-menu-item"
            p-rule="evenodd"
          />
        </svg>
        <div>
          <h1 class="gap-x-4 font-bold">{{invitation.email}}</h1>
          <p class="text-gray-600">{{invitation.role}}</p>
        </div>
      </div>
      <div class="flex gap-5">
        <a
          href="{{url_for('user-management.revoke_invitation',id=invitation._id)}}"
          class="button w-auto"
        >
          Revoke
        </a>
      </div>
    </div>
    {% endif %} {% endfor %} {% else %}
    <h1>No Invitations pending</h1>
    {% endif %}
  </div>
</div>

<!-- Modal for Inviting User -->
<div
  id="inviteModal"
  class="fixed inset-0 hidden items-center justify-center bg-gray-900 bg-opacity-50"
>
  <div class="rounded-lg bg-white p-6 shadow-lg md:w-1/3">
    <h2 class="mb-4 text-xl font-bold">Invite New User</h2>
    <form
      id="inviteUserForm"
      method="POST"
      action="{{ url_for('user-management.send_invitation') }}"
      novalidate
    >
      <label class="mb-2 block">Email:</label>
      {{form.email(class="mb-4 w-full rounded border p-2")}} {% for error in
      form.email.errors %}
      <span style="color: red"> {{ error }} </span>
      {% endfor %}

      <label class="mb-2 block">Role:</label>
      {{form.role(class="mb-4 w-full rounded border p-2")}} {% for error in
      form.role.errors %}
      <span style="color: red"> {{ error }} </span>
      {% endfor %}

      <div class="flex justify-end">
        <button
          type="button"
          onclick="closeInviteModal()"
          class="mr-2 rounded bg-gray-400 px-4 py-2 text-white"
        >
          Cancel
        </button>
        {{form.submit(class="rounded bg-blue-500 px-4 py-2 text-white")}}
      </div>
    </form>
  </div>
</div>
{% endblock %}
